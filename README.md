# Devstack client

Приложения для правления виртуальными машинами внутри devstack

### Запуск

Приложение протестированно для `Python 3.6`, поэтому рекомендуется запускать под этой версией

Для запуска надо склонировать репозиторий к себе, перейти в директорию с проектом, установить пакет - `pip install -e .` и выполнить следующую команду для запуска сервера: `python devstack_client/main.py`. После этого будет доступен локальный сервер с API для управления виртуальными машинами.

Также для запуска понадобятся следующие переменные окружения:
* **AUTH_URL** - URL Identity Devstack машины, с помощью которого осуществляется keystone аутентификация (меет вид - `http://<ip-addr>/identity`)
* **USERNAME** - Имя юзера
* **PASSWORD** - Пароль юзера
* **PROJECT_ID** - ID проекта с виртуальными машинами
* **USER_DOMAIN_NAME** - Домен юзера

Все переменные указанные выше можно найти в веб интерфейсе Horizon, который будет доступен после развертывания Devstack

Если указанные переменные не валидные или какие-то из них не указаны, то вернеться 403 ошибка с соответствующим сообщением

Также надо указать сикрет для Flask приложения - **APP_SECRET_KEY**

### Описание доступных методов

При запуске сервера на индексной странице будет доступна swagger документация с доступными методами (без подробного описания)

* **GET /api/v1/image** - Получение всех доступным образов для создания виртуальных машин
* **GET /api/v1/image/{name}** - Получение информации о конретном образе (либо по названию, либо по id)

* **GET /api/v1/flavor** - Получение всех доступных конфигурация машины (RAM, CPU, Disk)
* **GET /api/v1/flavor/{name}** - Получение информации о конкретной конфигурации машины (либо по имени, либо по id)

* **GET /api/v1/network** - Получение всех доступных сетей
* **GET /api/v1/network/{name}** - Получение информации о конкретной сети

* **GET /api/v1/server** - Получение всех запущенных виртуальных машин
* **GET /api/v1/server/{id}** - Получение информации о конкретной машине
* **POST /api/v1/server/** - Запуск новой виртуальной машины. Для запуска требуется указать image_id, flavor_id, network_id и name новой машины. Если указанные ресурсы превышают лимиты, то будет 400 ошибка, с соответствующим сообщением
* **DELETE /api/v1/server/{id}** - Удаление виртуальной машины

### Тесты

Для запуска тестов нужно выполнить следующую команду: `pytest`

Для запуска тестов с coverage'ом: `pytest --cov-report term-missing --cov devstack_client`
